import base64
import json
import os 
import re

pasta = r'...'

# Função para substituir caracteres inválidos em nomes de arquivos
def limpar_nome_arquivo(nome):
    return re.sub(r'[\\/*?:"<>|]', "_", nome)

for nome_arquivo in os.listdir(pasta):
    if nome_arquivo.endswith('.json'):  # Filtrar apenas arquivos .json
        caminho_completo = os.path.join(pasta, nome_arquivo)

        # Abrir e carregar o JSON com a codificação utf-8
        with open(caminho_completo, 'r', encoding='utf-8') as file:
            dados = json.load(file)
            json_data = dados

        # Extrair os campos necessários
        beneficiario_id = json_data['result']['beneficiarioId']
        arquivo_base64 = json_data['result']['arquivoBase64']
        tipo = json_data['result']['tipo']
        subtipo = json_data['result']['subTipo']
        id = json_data['result']['id']

        # Decodificar o Base64
        arquivo_bytes = base64.b64decode(arquivo_base64)

        # Limpar o nome do arquivo para remover caracteres inválidos
        nome_arquivo_salvo = f"{tipo} {subtipo} + {beneficiario_id} + {id}.pdf"
        nome_arquivo_salvo = limpar_nome_arquivo(nome_arquivo_salvo)
        caminho_arquivo_salvo = os.path.join(pasta, nome_arquivo_salvo)

        
        with open(caminho_arquivo_salvo, "wb") as file:
            file.write(arquivo_bytes)

        print(f"Arquivo salvo como {caminho_arquivo_salvo}")
